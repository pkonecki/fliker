= Notes =


* /!\documentation à faire/!\ *
  * schémas d'utilisation/fonctions pour chaque écran affiché
    * ex : workflow de la procédure d'inscription, etc.
  * au minimum lister toutes les fonctionalités et "politiques" codées (qui ne sont pas forcément dans cette liste wiki)
    * ex : gestion des droits (un adhérent qui est aussi responsable ne peut s'auto-gérer et doit demander à un autre resp de valider sa fiche)


===Urgences===
  * PAIEMENTS:
    * <s>affichage auto promo courante (si autre promo, utiliser menu déroulant en haut de page)</s>
    * <s>calcul auto total du paiement (pour comparaison avec val du chq)</s>
    * <s>stocker/afficher : paiement enregistré par "nom"</s>
    * <s>gestion statut : active/résilié</s>/impossible
    * <s>ajout champs "date de la transaction"</s>
  * PROMOS :
    * <s>bouton changer promo pour affichage (paiements + adhésions + présence)</s>
    * gestion des promos pour suppléments : ids différents et bouton pour recopier suppléments an dernier ...
    * bouton de purge en fin d'année : des certificats méd / n° carte (?) / adhérents n'ayant JAMAIS eu de paiements
  * RECHERCHE :
    * bouton pour n'afficher que les "responsables" (ass/sec/act/cre)
    * <s>bouton pour n'afficher que les "àjour" ou "pas àjour" (statut paiement)</s>
    * si aucun sport coché alors afficher les adhérents actifs mais sans adhésion pour promo en cours (uniquement pour resp asso)
    * bouton pour n'afficher que les "impossibles" (pour inciter bureau à activer un supplément)
    * comptes désactivés affichés en rouge ou avec un flag visible
  * ADHESIONS :
    * gestion des adhésions impossibles (basculer au statut actif si un supplément adéquat est rajouté + cf. notifications)
    * Ne pas afficher les créneaux <s>sans prof/responsables au dessus </s>(ni les section désactivées) (ni rien du tout si mode standby)
  * ADHERENTS :
    * bouton pour changer son passwd (seulement par adhérent)
    * bouton pour dés/activer un compte (seulement par admin)
    * bouton pour changer son statut (seulement par admin car admin devra supprimer un éventuel paiement déjà fait et le resaisir afin d'enregistrer la nouvelle valeur du supplément dû...)
    * bouton pour changer son email (par adhérent ou admin --> envoi d'un cookie/email pour réactivation)
    * affichage du certif
  * SECTION :
    * bouton pour désactiver une section : ne plus proposer dans la liste des nouvelles adhésions
  * AUTRES :
    * Table types de suppléments (cotiz, location, caution, supplément)
    * Table types de paiements (cheque/espece/cb/dispense)
    * <s>Association destinataire table supplément</s>
    * <s>Table mère pour asso/section/act/cre</s>
    * <s>Changer id_statut en id_asso_adh pour sec/act/cre</s>


===Config/Install du logiciel===
  * Fichier de config avec url base site, params connexion sql ...


===Login/Logout===
  * bouton "j'ai oublié mon passwd" --> renvoyer un cookie par email
  * peu urgent : bouton "je suis un gros boulet" --> rediriger vers "RT"
  * après l'étape "validate" (saisie mot de passe) on a un message "votre inscription est validée" mais on n'est pas redirigé 


===Notion de promo===
  * Page admin :
    * <s>changer de promo courante (stocker dans table sql)</s>
    * booléen mode standby (inscriptions ok mais pas d'adhesions)
  * <s>Champ promo dans table adhesions/paiements</s>
  * <s>Champ promo dans table présences</s>


===Changements UML===
    * <s>Nouveau supplément_cotisation asso</s>
    * <s>Supprimer champs cotisation dans asso</s>
    * <s>Généraliser Responsables (idem suppléments)</s>
    * <s>Supprimer lien id_prof adherent <> créneau</s>
    * <s>généraliser supplément sections / activité / creneaux </s>
    * <s>question association gestionnaire (reverser le supplément à la bonne association)</s>


===Associations===
  * Tables des statuts (etudiant/personel/exterieur)
  * +table d'associations possibles pour un statut (ex: etudiant --> Asesco et PSUC)
  * Choix des créneaux
  * Calcul des associations auxquelles s'inscrire par critère de priorité :
    # Maximum de sports
    # Minimum d'associations
    # Cout minimum
    # Random si plusieurs choix (rare)


===Sports===
  * Catégorie (basse priorité) : table de catégories + table de hash activité/categorie
    * Fonction de saisie/modif catégorie d'activité pour responsable activité + admin etc... 
  * <s>description</s>
  * <s>logo</s>


===Adhérents===
  * id_asso/num_carte --> table (plusieurs assos pour un adherent)
    * <s>Faire table de hash entre adh et asso</s>
  * <s>modularité --> deux tables : data + description des data </s>
  * <s>vérification : langage simplifié de format (à determiner)</s>
  * Séparer données login/données perso? Customisation supplémentaire assos locales	
  * -preinscription --> +date creation
  * <s>+signature valide quand adresse email validée</s>
  * +adresse professionnelle (cf customisation locale PSUC)
  * <s>+numéro d'agent</s>(cf numayantdroit : numéro de carte étudiant/CNRS etc...)
  * +champ exemple dans champs_adherent
  * +choix assurance : j'ai lu ou non / j'accepte ou non
  * +droit à l'image oui/non
  * <s>numcarte = numéro de carte asesco/PSUC etc...</s>
  * Champs date validation cookie/gestionnaire
  * Deux champs nom / tel pour personnes à contacter en cas d'urgence
  * <s>+ Statut (exterieur/CNRS/UFR Science/Droit/Pharma/Medecine/STAPS/IUT Orsay/Cachan/Sceaux/Polytech'ParisSud/Supoptique/Supélec/X/INRIA/CEA/autres académique)</s>
  * Vérification : case a cocher pour certain champs (doit être verifier) ex: numayantdroit/certificat med
    * LDAP utilisera cette case
    * Table de hash champ adherent < - > adherent + date


===Inscriptions===
  * <s>conservation données en post</s>
  * captcha? en confirmation (basse priorité)
  * <s>identifiant : email</s>
    * Demander 2 fois email
  * <s>gestion de password</s>
    * <s>Mot de passe : à la vérification, encryption md5</s> + salt
  * liste des sports:
    * <s>page séparée : oui</s>
    * liste dynamique en fct statut (etu/pers) /age/critères personalisés(prix/lieu/type/horaire)...
    * encourager l'inscription chez d'autres assos (liste unique + pop up d'info hover)
  * 2 Scénarii d'inscription:
    * recherche par critère (portail sport)
      * mémorisation des sports choisis
      * création d'une fiche adhérent
      * envoi d'email de confirmation (cookie) avec facture
    * inscription
      * création d'une fiche adhérent
      * envoi d'email de confirmation (cookie) sans facture
      * choix des sports (liste javascript)
      * affichage facture
  * Stocker dans un repertoire en modifiant le nom du fichier : id.ext		
    * Certificat médical
    * <s>photo</s>
    * Métadata des champs images:
      * Permanent o/n
      * Date de purge
      * Age de purge
      * Extension du format par défaut
      * Taille de redimensionnement par défaut
      * Taille thumb
  * Compétiteur : vrai /faux
    * Basse priorité
    * Gestion via fonctions existantes (section/activité/supplément) : documenter
  * Case a cocher : je n'ai pas d'adresse email
    * Possibilité de rajouter l'adresse email par le bureau plus tard --> envoie d'email de confirmation
  * Catégorie Homme/Femme --> Masculin/Féminin
  * Adhesion: Pour un sport, calculer l'asso possible seulement si il y'a un supplément au niveau de la section au moins. Mais tout afficher (inscription illégitime) : "Impossible pour l'instant" 


===Paiements===
  * <s>Faire table de hash paiement < - > adhésion </s>
  * Numéro de carte asesco: en générer un qu'a partir du moment ou l'inscription est validée/payée
    * possibilité de créer un nouveau numéro (carte perdue)
    * ne pas créer un numéro si il existe déjà
    * Boite avec propositions de numéro libres et possibilité de remplir un numéro à la main en vérifiant la disponibilité à la volée
  * Solde: prendre adhesion selon mycréneau puis selects paiements de ces adhesions


===Présences===
  * <s> Table de hash créneau < - > adhérent </s>
    * <s> Afficher/Remplir présence --> pour chaque créneau dont je suis responsable : tableau adhérents / semaines avec cases à cocher </s>
    * <s> Affichage / archivage selon promo </s>
    * Imprimer fiche de présence
  * Evénements exceptionnels (stages, matchs...) : table spéciale ?
  * Stocker dates vac et fériés pour supprimer colonnes présences ?


===Recherches===
  * Recherche modulaire : 
    * <s>Ajouter regles de recherche / et </s>/ou
    * <s>Par defaut: nom,prénom,email,catégorie (détecter si vide) --> utiliser table des champs</s>
    * Selection des colonnes à afficher
  * Critères:
    * <s>Nom, Prénom, Email, Catégorie (masculin/féminin)</s>
    * <s>Par créneau/activité/section/asso --> menu arbre</s>
      * Décocher automatiquement si vide en dessous
    * <s>Check : Avec ou sans photo</s>
    * Afficher seulement les profs / bureau / webmaster (checkbox)
    * <s>Radio: Complet/Normal/Trombino</s>
    * Check: Adhésion illégitime (=pas de supplément défini)
    * <s>Select Solde a jour/pas a jour</s>
  * <s>Restreindre liste des sports en fonction du niveau (que les sports d'un prof)</s>	
  * Possibilité recherche restreinte (juste nom/prénom + case envoi email (mais email caché)) pour les simples pratiquants dans leur activité


===Fonctions de saisie/modification===
  * Gestion de privilèges descendante (Bureau peut attribuer droit prof)
    * Notification email prof bureau en cas de modif de ses droits
      * (BP) Préférences notification weekly/daily/a chaque fois/non
    * Privilèges détectés par les tables de hash responsables
      * Donne droit modification sur tout (sauf responsable) ce qui est  à son niveau et en dessous
      * Donne droit a donner des droits (=designer un responsable) seulement sur ce qui est en dessous et dans la même association
    * Administrateur : champ privilège à 1 dans table adhérent
  * Ajout Enregistrement paiement --> bureau
  * Table de hash asso/section (initialisée par création section) --> défini qui a le droit supprimer/modifier la section y compris les suppléments + donne le droit de recherche
    * Les suppléments définissent un droit de recherche sur les sections/etc... aussi bien avec id_asso_paie que id_asso_adh
  * Association 
    * Ajout entité
    * Ajout Supplément
    * Ajout Responsable
  * Section
    * Ajout entité
    * Ajout Supplément
    * Ajout Responsable
    * Ajout (mais pas suppression) d'association gestionnaire dans la table de hash
  * Activité
    * Ajout entité
    * Ajout Supplément
    * Ajout Responsable
  * Créneau
    * Ajout entité
    * Ajout Supplément
    * Ajout Responsable
  * Paiement
    * Ajout entité : par bureau de sup.id_asso_paie
  * Adhésion
  * Fiche Adhérent

	
=== Envoi d'Email===
  * bien gérer le from
    * Bureau-asesco.asso@u-psud.fr si c'est un membre du bureau, adresse email prof sinon
  * Bien gérer le to
    * Vérifier qu'on envoie pas l'email deux fois à une même personne
    * Un email par personne ; question timer/repartition dans le temps
    * Mettre les TO en BCC:
  * Conserver un copie des mails envoyés ou au moins mettre le from en CC: 
  * Vérifier bounces : si erreur revenue alors désactiver email/compte destinataire ...
  * Possibilité pour un adhérent de se mettre en "liste rouge" (seulement contre mails des autres adhérents)


===Alertes / Notifications===
  * Interface pour customiser "mon espace" (réceptions immédiates ou "digests" daily/weekly ...) :
    * *tous :*
      * compte désactivé : immédiat
      * changement email : immédiat (TO: ancien + nouveau email)
    * *pratiquants :* peuvent refuser de recevoir mails des co-pratiquants mais obligation recevoir mails des resps + alertes :
      * pas à jour ou pas certif : weekly (ou val réglée par resp)
      * pas d'adhésion cette année : 6 mois (ou val réglée par resp)
      * adhésion devenue possible : choisir une asso
    * *responsables :* obligation recevoir tous mails + alertes mais réglage possible des fréquences :
      * stats de taille de la base sql (prévenir risques explosions) : weekly
      * nouvelle adhésion impossible : immédiat
      * nouvelle adhésion (invitation à prendre contact) : immédiat
      * section désactivée : immédiat
  * Interface pour déclencher manuellement ou cron (daily/weekly ...) les checks :
    * /!\ Gens pas à jour (solde != 0 ou adhésions devenues possibles)
    * /!\ Pas de certificats médical (surtout pour compétiteurs)
    * /!\ Pas d'adhésion
    * /!\ Pas de confirmation du cookie par email et/ou email invalide
    * /!\ Adhésion impossible
    * /!\ Paiement qui ne correspond plus à une facture (ex : statut du pratiquant a changé or paiement déjà fait => plus de correspondance paiement/supplément => admin doit detruire paiement et le resaisir)


===plugin LDAP===
  * booléen d'activation du check + params connexion dans table/config
  * champs validation LDAP : 3 valeurs : faux/vrai/desactivé
  * + réglage fréquence du check
  * + notification associée vers responsable (et pratiquant ?)


===plugins paiements en ligne===
  * SoGé ?
  * Paypal ?


===plugin "inventaire"===
  * stocker les achats de matériel pour chaque section
    * date (promo) d'acquisition, coût, upload pdf devis/facture, etc.
    * fonction d'affichage (tri par promo, par coût, par nom)
    * fonction de saisie/modif/suppresion


===Synoptiques/Statistiques===
  * tableau promos / sections
    * nbr d'inscrits à jour (par assos)
    * nbr d'inscrits assidus mais pas à jour (par assos)
    * nbr touristes = pas assidus et pas à jour (par assos)
    * recettes (total des suppléments) & dépenses (cf. plugin inventaire) & bilan annuel (+ bilan annuel cumulé des sections = asso)


===peu urgent : Table de Customisation / Admin===
  * ajouter des champs dans la fiche adhérent
    * et gérer les descriptions + formats de saisie acceptés
  * stocker/modifier Bornes de la Promo courante
    * actuellement hardcodé = (next Monday after 31/08 --> sem du 30/06)
  * interface pour créer des alertes
  * internationalisation :
    * <s>gestion du symbole monétaire</s>
    * param de config pour choisir langue
    * codage des strings affichées à l'écran dans des tables sql, indéxées par le param de locale ... (cf. wikipedia)