<?phpdefined('_VALID_INCLUDE') or die('Direct access not allowed.');$tot_asso=count(getAssociations($_SESSION['uid']));$tot_sec=count(getSections($_SESSION['uid']));$tot_act=count(getActivites($_SESSION['uid']));$tot_cre=count(getCreneaux($_SESSION['uid']));$tot = $tot_asso + $tot_sec + $tot_act + $tot_cre;if((strcmp($_SESSION['user'],"") == 0)){	print "<p>Vous n'êtes pas connecté</p>";	die();}if ($_SESSION['privilege'] == 1)	$tab_asso = getAssociations($_SESSION['uid']);else if (isset($tot_asso) && $tot_asso > 0)	$tab_asso = getAssociations($_SESSION['uid']);else if (isset($tot_sec) && $tot_sec > 0){	$tab_section = getSections($_SESSION['uid']);	$string_id_sec = "";	foreach ($tab_section as $tmp_array)		$string_id_sec .= ", ". $tmp_array['id'];	$string_id_sec[0] = ' ';	$res = doQuery("SELECT * FROM {$GLOBALS['prefix_db']}asso_section WHERE id_sec IN (".$string_id_sec.")");	$string_id_asso = "";	while ($tmp_array = mysql_fetch_array($res))		$string_id_asso .= ", ".$tmp_array['id_asso'];	$string_id_asso[0] = ' ';	$res = doQuery("SELECT * FROM {$GLOBALS['prefix_db']}association WHERE id IN (".$string_id_asso.")");	while ($tmp_array = mysql_fetch_array($res))		$tab_asso[$tmp_array['id']] = $tmp_array;}else{	print "<p>Vous n'avez pas accès à cette page!</p>";	die();}if(isset($_GET['promo']))	$promo=$_GET['promo'];else	$promo=$current_promo;if(!(strcmp($_SESSION['user'],"") == 0)){	$tab=getAssociations($_SESSION['uid']);	print '<ul id="submenu">';	if((isset($tot_asso) && $tot_asso > 0) || (isset($tot_sec) && $tot_sec > 0))		print '<li><a class="'.(($_GET['page']== 16) ? 'selected' : '').'" href="index.php?page=16">Opérations</a></li>';	if((isset($tot_asso) && $tot_asso > 0) || (isset($tot_sec) && $tot_sec > 0))		print '<li><a class="'.(($_GET['page']==14) ? 'selected' : '').'" href="index.php?page=14">Récapitulatif</a></li>';	if((isset($tot_asso) && $tot_asso > 0) || (isset($tot_sec) && $tot_sec > 0))		print '<li><a class="'.(($_GET['page']==17) ? 'selected' : '').'" href="index.php?page=17">Inventaire</a></li>';	print '</ul>';}print "<br/>";if (isset($_POST['new_dep'])){	$query = "INSERT INTO {$GLOBALS['prefix_db']}finances (type, type_transaction, emetteur, beneficiaire, montant, date_transaction, date_enregistrement, nom_signataire, nom_enregistreur, description, type_register) VALUES('".$_POST['type_dep']."', '".$_POST['type_transaction']."', '".$_POST['emetteur']."', '".$_POST['beneficiaire']."', '".$_POST['montant']."', '".$_POST['date_transa']."', CURRENT_TIMESTAMP()+0, '".$_POST['signataire']."', '".$_SESSION['user']."', '".$_POST['description']."', 'depense')";	$res = doQuery($query);	if (!$res)	{		echo mysql_error();		print "<FONT COLOR='#FF0000'><b>Une erreur c'est produite lors de l'opération, l'entrée n'a pas été ajouté</b></font>";	}	else		print "<FONT COLOR='#16B84E'><b>Dépense enregistré</b></font>";	print "<br/><br/>";}if (isset($_POST['new_rec'])){	$query = "INSERT INTO {$GLOBALS['prefix_db']}finances (type, type_transaction, emetteur, beneficiaire, montant, date_transaction, date_enregistrement, nom_signataire, nom_enregistreur, description, type_register) VALUES('".$_POST['type_dep']."', '".$_POST['type_transaction']."', '".$_POST['emetteur']."', '".$_POST['beneficiaire']."', '".$_POST['montant']."', '".$_POST['date_transa']."', CURRENT_TIMESTAMP()+0, '".$_POST['signataire']."', '".$_SESSION['user']."', '".$_POST['description']."', 'recette')";	$res = doQuery($query);	if (!$res)	{		echo mysql_error();		print "<FONT COLOR='#FF0000'><b>Une erreur c'est produite lors de l'opération, l'entrée n'a pas été ajouté</b></font>";	}	else		print "<FONT COLOR='#16B84E'><b>Recette enregistré</b></font>";	print "<br/><br/>";}print 	"<div style='float:left;'><table><form method='POST' action='index.php?page=16'>		<tr><th colspan='2' align='center'><b>Enregistrer une nouvelle dépense</b></th></tr>		<tr><td>Type de dépense:</td><td><select name='type_dep'>";		$res = doQuery("SELECT * FROM {$GLOBALS['prefix_db']}type_dep ORDER BY nom ASC");		while ($tmp_array = mysql_fetch_array($res))			print "<option value='".$tmp_array['nom']."'>".$tmp_array['nom']."</option>";		print "</select></td></tr>		<tr><td>Type de transaction : </td><td><select name='type_transaction'>";		$res = doQuery("SELECT * FROM {$GLOBALS['prefix_db']}type_transa ORDER BY nom ASC");		while ($tmp_array = mysql_fetch_array($res))			print "<option value='".$tmp_array['nom']."'>".$tmp_array['nom']."</option>";		print "</select></td></tr>		<tr><td>Emetteur : </td>";				$list_enti = null;		$tmp_list_sec = null;		$tmp_adh_resp = null;		$res= doQuery("SELECT * FROM {$GLOBALS['prefix_db']}association ORDER BY nom ASC");		while ($tmp_array = mysql_fetch_array($res))			$list_enti[$tmp_array['id']] = $tmp_array['nom'];		$res= doQuery("SELECT * FROM {$GLOBALS['prefix_db']}section ORDER BY nom ASC");		while ($tmp_array = mysql_fetch_array($res))			$tmp_list_sec[$tmp_array['id']] = $tmp_array['nom'];		$res= doQuery("SELECT * FROM {$GLOBALS['prefix_db']}resp_asso WHERE id_adh=".$_SESSION['uid']."");		if (mysql_num_rows($res) > 0)			while ($tmp_array = mysql_fetch_array($res))				$tmp_adh_resp[$tmp_array['id_asso']] = 1;		$res= doQuery("SELECT * FROM {$GLOBALS['prefix_db']}resp_section WHERE id_adh=".$_SESSION['uid']."");		if (mysql_num_rows($res) > 0)			while ($tmp_array = mysql_fetch_array($res))				$tmp_adh_resp[$tmp_array['id_sec']] = 1;						$res= doQuery("SELECT * FROM {$GLOBALS['prefix_db']}asso_section");		while ($tmp_array = mysql_fetch_array($res))			$list_enti[$tmp_array['id_sec']] = $list_enti[$tmp_array['id_asso']]." => ".$tmp_list_sec[$tmp_array['id_sec']];		asort($list_enti);		print "<td><select name='emetteur'>";		foreach ($list_enti as $key => $value)			if (isset($tmp_adh_resp[$key]) || $_SESSION['privilege'] == 1)				print "<option name='choix' value='".$key."'>".$value."</option>";		print "</select></td></tr>		<tr><td>Bénéficiaire : </td><td><input name='beneficiaire' type='text' required  /></td></tr>		<tr><td>Nom du signataire : </td><td><SELECT name='signataire' class='filterselect' >";			$candidates = getAdherents();			foreach ($candidates as $key => $value)				print '<OPTION value='.$key.' >'.$value['prenom'].' '.$value['nom'].'</OPTION>';		print "</SELECT></td></tr>		<tr><td>Date de transaction : </td><td><input name='date_transa' type='text' class='datepicker' required /></td></tr>		<tr><td>Montant (en €): </td><td><input name='montant' type='number' required /></td></tr>		<tr><td>Description : </td><td><input name='description' type='text' /></td></tr>		<tr><td colspan='2' align='center'><input name='new_dep' type='submit'/></td>		</form></table></div>";if (isset($_POST['validation']))	$res = doQuery("UPDATE {$GLOBALS['prefix_db']}finances SET validation=1, verification='".$_POST['validation']."' WHERE id=".$_POST['id_transa']." ");print 	"<table><form method='POST' action='index.php?page=16'>		<tr><th colspan='2' align='center'><b>Enregistrer une nouvelle recette</b></th></tr>		<tr><td >Type de dépense:</td><td><select name='type_dep'>";		$res = doQuery("SELECT * FROM {$GLOBALS['prefix_db']}type_dep ORDER BY nom ASC");		while ($tmp_array = mysql_fetch_array($res))			print "<option value='".$tmp_array['nom']."'>".$tmp_array['nom']."</option>";		print "</select></td></tr>		<tr><td>Type de transaction : </td><td><select name='type_transaction'>";		$res = doQuery("SELECT * FROM {$GLOBALS['prefix_db']}type_transa ORDER BY nom ASC");		while ($tmp_array = mysql_fetch_array($res))			print "<option value='".$tmp_array['nom']."'>".$tmp_array['nom']."</option>";		print "</select></td></tr>		<tr><td>Emetteur : </td><td><input name='emetteur' type='text' required /></td></tr>		<tr><td>Bénéficiaire : </td>";		$list_enti = null;		$tmp_list_sec = null;		$tmp_adh_resp = null;		$res= doQuery("SELECT * FROM {$GLOBALS['prefix_db']}association ORDER BY nom ASC");		while ($tmp_array = mysql_fetch_array($res))			$list_enti[$tmp_array['id']] = $tmp_array['nom'];		$res= doQuery("SELECT * FROM {$GLOBALS['prefix_db']}section ORDER BY nom ASC");		while ($tmp_array = mysql_fetch_array($res))			$tmp_list_sec[$tmp_array['id']] = $tmp_array['nom'];		$res= doQuery("SELECT * FROM {$GLOBALS['prefix_db']}resp_asso WHERE id_adh=".$_SESSION['uid']."");		if (mysql_num_rows($res) > 0)			while ($tmp_array = mysql_fetch_array($res))				$tmp_adh_resp[$tmp_array['id_asso']] = 1;		$res= doQuery("SELECT * FROM {$GLOBALS['prefix_db']}resp_section WHERE id_adh=".$_SESSION['uid']."");		if (mysql_num_rows($res) > 0)			while ($tmp_array = mysql_fetch_array($res))				$tmp_adh_resp[$tmp_array['id_sec']] = 1;						$res= doQuery("SELECT * FROM {$GLOBALS['prefix_db']}asso_section");		while ($tmp_array = mysql_fetch_array($res))			$list_enti[$tmp_array['id_sec']] = $list_enti[$tmp_array['id_asso']]." => ".$tmp_list_sec[$tmp_array['id_sec']];		asort($list_enti);		print "<td><select name='beneficiaire'>";		foreach ($list_enti as $key => $value)			if (isset($tmp_adh_resp[$key]) || $_SESSION['privilege'] == 1)				print "<option name='choix' value='".$key."'>".$value."</option>";		print "</select></td></tr>		<tr><td>Nom du signataire : </td><td><SELECT name='signataire' class='filterselect' >";			$candidates = getAdherents();			foreach ($candidates as $key => $value)				print '<OPTION value='.$key.' >'.$value['prenom'].' '.$value['nom'].'</OPTION>';		print "</SELECT></td></tr>		<tr><td>Date de transaction : </td><td><input name='date_transa' type='text' class ='datepicker' required /></td></tr>		<tr><td>Montant (en €): </td><td><input name='montant' type='number' required /></td></tr>		<tr><td>Description : </td><td><input name='description' type='text' /></td></tr>		<tr><td colspan='2' align='center'><input name='new_rec' type='submit'/></td>		</form></table>";				print "<br/>";		$res = doQuery("SELECT * FROM {$GLOBALS['prefix_db']}finances WHERE validation=0 ");		if (mysql_num_rows($res) > 0)		{			print 	"<table>						<tr align='center'><th>Type de sup</th><th>Type de transaction</th><th>Numéro de transaction</th><th>Emmetteur</th><th>Bénéficiaire</th><th>Montant</th><th>Date de transaction</th><th>Signataire</th><th>Enregistreur</th><th>Description</th><th>Objet inventaire</th><th>Autoriser ?</th></tr>";			while ($tmp_array = mysql_fetch_array($res))			{				print "<tr align='center'><td>".$tmp_array['type']."</td><td>".$tmp_array['type_transaction']."</td><td>".$tmp_array['num_transaction']."</td><td>".$tmp_array['emetteur']."</td><td>".$tmp_array['beneficiaire']."</td><td>".$tmp_array['montant']."</td><td>".$tmp_array['date_transaction']."</td><td>".$tmp_array['nom_signataire']."</td><td>".$tmp_array['nom_enregistreur']."</td><td>".$tmp_array['description']."</td><td>".$tmp_array['id_obj_inventaire']."</td><td><form method='POST' action='index.php?page=16'><input type='hidden' name='id_transa' value=".$tmp_array['id']." /><input type='submit' name='validation' value='Oui'/><input type='submit' name='validation' value='Non'/></form></td></tr>";			}			print 	"</table>";		}?>